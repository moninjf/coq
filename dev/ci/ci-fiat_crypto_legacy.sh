#!/usr/bin/env bash

set -e

ci_dir="$(dirname "$0")"
. "${ci_dir}/ci-common.sh"

FORCE_GIT=1
git_download fiat_crypto_legacy

targets1=(
    print-old-pipeline-lite-hardcoded
    old-pipeline-lite-hardcoded
    lite-display-hardcoded
)
targets2=(
    print-old-pipeline-nobigmem-hardcoded
    old-pipeline-nobigmem-hardcoded
    nonautogenerated-specific
    nonautogenerated-specific-display
    selected-specific
    selected-specific-display
)

export COQEXTRAFLAGS='-native-compiler no'
( cd "${CI_BUILD_DIR}/fiat_crypto_legacy"
  git submodule update --init --recursive
  make "${targets1[@]}"
  make -j 1 "${targets2[@]}"
)
